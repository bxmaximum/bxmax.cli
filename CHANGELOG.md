# Changelog

Все важные изменения в проекте BXMax CLI будут документироваться в этом файле.

## [1.1.0] - 2025-10-26

### Добавлено

#### Резервное копирование (4 команды)
- `backup:create` - создание резервной копии сайта средствами Битрикса с полной поддержкой всех параметров экспертного режима
- `backup:list` - список созданных резервных копий с сортировкой и фильтрацией
- `backup:restore` - восстановление сайта из резервной копии с опциональным пропуском файлов или БД
- `backup:clean` - удаление старых резервных копий по критериям (возраст, количество, шаблон)

**Основные опции:**
  - Создание полного бэкапа (файлы + база данных)
  - Опция `--skip-kernel` - исключить ядро Битрикса
  - Опция `--skip-public` - исключить публичную часть
  - Опция `--skip-db` - исключить базу данных
  - Опция `--name` - задать имя архива
  - Опция `--no-compression` - отключить сжатие архива

**Исключения из базы данных:**
  - Опция `--skip-stat` - исключить статистику из БД (таблицы b_stat*)
  - Опция `--skip-search` - исключить поисковый индекс из БД (таблицы b_search_*)
  - Опция `--skip-log` - исключить журнал событий из БД (таблица b_event_log)

**Исключения файлов:**
  - Опция `--exclude-dir` - исключить директорию из бэкапа (можно указать многократно)
  - Опция `--exclude-file` - исключить файл из бэкапа (можно указать многократно)
  - Опция `--exclude-mask` - исключить файлы по маске, например `*.log`, `tmp/*` (можно указать многократно)
  - Опция `--max-file-size` - исключить файлы размером более указанного в КБ (по умолчанию: 0 - без ограничения)

**Экспертные настройки (соответствуют параметрам формы Битрикса):**
  - Опция `--no-integrity-check` - отключить проверку целостности архива (по умолчанию: проверка включена)
  - Опция `--max-exec-time` - длительность шага в секундах (по умолчанию: 300)
  - Опция `--max-exec-time-sleep` - интервал между шагами в секундах (по умолчанию: 3)
  - Опция `--archive-size-limit` - максимальный размер несжатых данных в одной части архива в МБ, 11-2047 (по умолчанию: 100)

**backup:list - Список резервных копий:**
  - Опция `--sort` - сортировка по дате, размеру или имени (по умолчанию: date)
  - Опция `--limit` - ограничение количества отображаемых бэкапов
  - Отображение размера каждого архива и общего размера
  - Табличный вывод с информацией о дате создания

**backup:restore - Восстановление из бэкапа:**
  - Аргумент `archive` - имя файла архива для восстановления
  - Опция `--skip-db` - не восстанавливать базу данных
  - Опция `--skip-files` - не восстанавливать файлы
  - Опция `--force` - пропустить подтверждение (использовать с осторожностью)
  - Опция `--max-exec-time` - длительность шага в секундах (по умолчанию: 300)
  - Автоматическое нахождение SQL файла для восстановления БД
  - Восстановление с проверкой целостности
  - Предупреждения перед началом операции

**backup:clean - Удаление старых бэкапов:**
  - Опция `--days` - удалить бэкапы старше указанного количества дней
  - Опция `--keep` - оставить указанное количество последних бэкапов
  - Опция `--pattern` - удалить бэкапы по шаблону имени
  - Опция `--force` - пропустить подтверждение
  - Опция `--dry-run` - показать какие файлы будут удалены, но не удалять
  - Отображение размера освобожденного места

**Возможности backup:create:**
  - Автоматическое создание дампа MySQL средствами Битрикса
  - Сохранение архивов в формате `.tar.gz` (или `.tar` без сжатия) в `/bitrix/backup/`
  - Отображение всех параметров бэкапа перед началом
  - Отображение размера созданного архива и количества примененных исключений
  - Интеграция с системой исключений Битрикса через `$skip_mask_array`
  - Полное соответствие параметрам веб-интерфейса `/bitrix/admin/dump.php`

### Улучшения
- Расширена документация с подробным описанием всех параметров и значений по умолчанию
- Добавлены примеры для всех вариантов использования (основные, исключения БД, файлов, экспертные настройки)
- Добавлена секция "Параметры по умолчанию" для понимания стандартного поведения команды
- Возможность создавать "чистые" бэкапы без статистики, кеша, логов и временных файлов
- Возможность тонкой настройки производительности через экспертные параметры
- Добавлены хелперы: `IblockHelper` (очистка кеша инфоблоков) и `SiteHelper` (получение доменов сайта)
- Улучшены команды управления агентами с новыми опциями фильтрации (`agent:list` - добавлены `--limit`, `--active`, `--inactive`, `--module`)
- Улучшены команды для инфоблоков, поиска, сайтов, пользователей и базы данных с дополнительными опциями

## [1.0.0] - 2025-10-20

### Добавлено

#### Управление модулями (4 команды)
- `module:list` - список установленных модулей с версиями
- `module:install` - установка модуля
- `module:uninstall` - удаление модуля с подтверждением
- `module:github` - загрузка и установка модуля с GitHub

#### Управление кешем (2 команды)
- `cache:clear` - полная очистка всех типов кеша (основной, тегированный, композитный)
- `cache:type:clear` - очистка кеша определенного типа

#### Управление пользователями (3 команды)
- `user:list` - список пользователей с фильтрами (активные, лимит)
- `user:create` - создание пользователя с полными данными
- `user:password` - смена пароля пользователя по логину или email

#### Управление инфоблоками (3 команды)
- `iblock:list` - список всех инфоблоков
- `iblock:elements` - список элементов инфоблока с пагинацией
- `iblock:facet-rebuild` - пересоздание фасетного индекса для умного фильтра

#### Управление поиском (1 команда)
- `search:reindex` - переиндексация поискового индекса с различными опциями

#### Управление агентами (2 команды)
- `agent:list` - список агентов с фильтрами
- `agent:run` - запуск всех активных агентов

#### Управление сайтами (2 команды)
- `site:list` - список всех сайтов
- `site:info` - детальная информация о сайте

#### Отладка и диагностика (1 команда)
- `debug:config` - просмотр конфигурации системы с фильтрацией по ключу

#### База данных (1 команда)
- `db:info` - информация о базе данных и статистика

### Особенности
- Форматированный вывод с использованием SymfonyStyle
- Таблицы для отображения списков данных
- Поддержка опций и аргументов команд
- Обработка ошибок
- Интерактивные подтверждения для критичных операций
- Полная документация с примерами использования

### Технические детали
- PHP 8.1+
- Использование Symfony Console Component
- PSR-4 автозагрузка
- Пространство имен: `Bxmax\Cli\Command\*`
- Регистрация команд через `.settings.php` модуля

---

## Планы на будущее

### [1.2.0] - Планируется
- Команды для работы с highload-блоками
- Команды для работы с почтовыми шаблонами
- Команды для управления правами доступа
- Экспорт/импорт данных

### [1.3.0] - Планируется
- Интеграция с API для автоматизации
- Расширенная работа с бэкапами (инкрементальные бэкапы, автоматизация)
- Интеграция с внешними системами хранения бэкапов

### [1.4.0] - Планируется
- Команды для работы с бизнес-процессами
- Команды для управления задачами

